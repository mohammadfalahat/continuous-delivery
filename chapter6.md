
# فصل ۶: اسکریپت‌نویسی Build و Deployment

## ۶.۱ نکات و ترفندهای .NET
.NET دارای ویژگی‌ها و پیچیدگی‌های خاص خود است که باید مراقب آنها باشید:
- فایل‌های Solution و project در .NET تنها فایل‌هایی را می‌سازند که در آن‌ها ارجاع داده شده‌اند. اگر فایلی در Solution وجود نداشته باشد اما در سیستم فایل باشد، ممکن است باعث سردرگمی و خطا شود. برای حذف این فایل‌ها، می‌توانید ویژگی «Show Hidden Files» را در Visual Studio فعال کرده و فایل‌های بدون آیکون را حذف کنید.
- پوشه‌های **bin** و **obj** را در فرآیند clean حذف کنید. ساده‌ترین روش، استفاده از دستور clean در Devenv است که همه این پوشه‌ها را پاک می‌کند.

## ۶.۲ مقدمه
در این فصل، منظور از “script” مجموعه اتوماسیون‌هایی است که به کمک آن‌ها فرایند build، test، deploy و release نرم‌افزار پیاده‌سازی می‌شود. اگرچه ممکن است در نگاه اول پیچیده به نظر برسد، اما هر گام در اسکریپت ساده است. توصیه می‌کنیم با **deployment pipeline** به‌عنوان راهنما پیش بروید و گام‌به‌گام مهم‌ترین بخش‌های دردسرساز را خودکار کنید. همکاری بین تیم‌های توسعه و عملیات را از ابتدا در نظر بگیرید تا ابزارها و اسکریپت‌ها به‌خوبی طراحی شوند.

## ۶.۳ Overview of Build Tools
ابزارهای رایج برای اسکریپت‌نویسی build عبارت‌اند از:
- **Make**, **Ant**, **NAnt**, **MSBuild**, **Maven**, **Rake**, **Buildr**, **Gradle**, **Psake** و غیره.
- ابزارهایی مانند **Buildr** و **Gradle** بر پایه DSL طراحی شده‌اند و قابلیت مدیریت وابستگی و پروژه‌های چندماژوله را ساده می‌کنند.

## ۶.۴ ایجاد Script برای هر مرحله از Deployment Pipeline
ساختار اسکریپت‌ها باید مطابق مراحل **deployment pipeline** باشد:
1. **Commit Stage**: کامپایل کد، بسته‌بندی، اجرای unit test و تحلیل کد.  
2. **Automated Acceptance Tests**: deploy خودکار به محیط تست و اجرای تست‌های functional.  
3. **Nonfunctional Tests**: اجرای تست‌های performance و امنیت.  
اسکریپت‌ها را در همان مخزن نسخه کنترل کد ذخیره کنید تا امکان همکاری بین توسعه و عملیات فراهم باشد.

## ۶.۵ استفاده از ابزار مناسب برای Deploy نرم‌افزار
در هر مرحله پس از Commit، معمولاً نیاز است که نرم‌افزار به محیطی شبیه production استقرار یابد. برای این کار:
- از ابزارهای تخصصی middleware مانند **Wsadmin** برای WebSphere استفاده کنید.  
- در صورت پیچیدگی کم، می‌توانید از اسکریپت‌های **scp/rsync** و **ssh** (یا **PsExec** و **PowerShell** در ویندوز) بهره ببرید.  
- ابزارهای سطح بالاتر مانند **Fabric**, **Func**, **Capistrano** نیز وجود دارند.

## ۶.۶ لایه‌بندی Deployment و تست لایه‌ها
استقرار نرم‌افزار را به صورت لایه‌ای انجام دهید:
1. **Operating System**  
2. **Middleware و Dependencies**  
3. **Application**  
بعد از هر لایه، تست‌های سریع (smoke tests) اجرا کنید تا از صحت پیکربندی مطمئن شوید. مثال‌ها:
- واکشی یک رکورد از پایگاه داده  
- ارسال ping به فایروال  
- تست دسترسی به web service.

## ۶.۷ تست پیکربندی Environment
برای هر لایه:
- بررسی کنید middleware نصب و در حال اجرا باشد.  
- نسخه صحیح سرویس‌ها را اعتبارسنجی کنید.  
- در صورت نقص، deployment متوقف شود.

---

**تمام اسکریپت‌ها** باید در همه محیط‌ها (توسعه، تست، staging، production) یکسان باشند. تفاوت‌ها تنها در پیکربندی (Configuration) هستند.
